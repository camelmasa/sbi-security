#!/usr/bin/env ruby
$:.unshift File.expand_path('../../lib', __FILE__)

require 'sbi/security'
require 'sbi/security/format'
require 'terminal-table'
require 'colorize'

include Sbi::Security::Format

client = Sbi::Security::Client.new(ENV["SBI_SECURITY_USER_ID"], ENV["SBI_SECURITY_PASSWORD"])

rows = []
rows << %w(コード 銘柄 数量 参考単価 現在値 前日比 前日(%) 損益 損益(%) 評価額)
rows << :separator
client.portfolio.stocks.each do |stock|
  rows << [
    stock.code,
    stock.name,
    number_to_currency(stock.count),
    number_to_currency(stock.value),
    number_to_currency(stock.price),
    format(stock.price_ratio),
    format(stock.price_ratio_percentage),
    format(stock.profit),
    format(stock.profit_percentage),
    number_to_currency(stock.total_value)
  ]
end

puts Terminal::Table.new(rows: rows)
exit 0
